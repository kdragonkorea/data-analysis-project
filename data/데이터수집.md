## 데이터 수집

#### 인스타그램 데이터 수집할 정보와 목표 설정

1. 인스타그램에서 데이터를 수집할 정보는 `#제주도맛집`으로 검색한 약 3백만개의 포스팅 중에서 각각의 컨텐츠를 클릭하여 아래와 같이 7개의 정보를 가져오도록 코드를 구현하였습니다. 
   
   * 각각의 컨텐츠에서 수집할 데이터 정보: `계정, 본문 내용(해시태그 포함), 게시날짜, '좋아요'수 또는 '조회'수, 첫번째 댓글 내용, 첫번째 댓글의 댓글 내용` 
   
2. `#제주도맛집` 으로 검색된 컨텐츠가 프로젝트를 수행한 시기(2021년 3월) 기준으로 1일 약 1000개 이상의 포스팅이 업로드 되고 있기 때문에 데이터 분석 프로젝트 수행 기간(5일)을 고려했을 때 30,000개의 포스팅 데이터 정보를 수집하는데 목표를 설정하였습니다.

   ![제주도맛집](https://user-images.githubusercontent.com/74410630/112266010-cc08d700-8cb6-11eb-93b6-134b06227e2b.JPG)

#### 인스타그램 크롤링 작업 순서

1. RSelenium, httr, rvest 라이브러리를 통해 `#제주도맛집` 검색된 결과의 첫 번째 컨텐츠 (인기 게시물이 아닌 최신 사진)를 클릭합니다.

   ![최근사진](https://user-images.githubusercontent.com/74410630/112266043-d62ad580-8cb6-11eb-8d1c-da4ca44856fd.JPG)

2. 클릭했을 때 보여지는 컨텐츠의 `계정, 본문 내용(해시태그 포함), 게시날짜, '좋아요'수 또는 '조회'수, 첫번째 댓글 내용, 첫번째 댓글의 댓글 내용` 을 수집합니다.

3. 우측 화살표 모양의 버튼을 클릭하여 다음 포스팅 화면으로 이동합니다.

   ![데이터수집](https://user-images.githubusercontent.com/74410630/112266071-de831080-8cb6-11eb-8e0b-854f71c9c21e.JPG)

4. 데이터가 정상적으로 로딩할 수 있도록 5초의 여유시간(Sys.sleep(5))을 설정합니다. (2초, 3초, 4초를 진행하였을 경우 element를 찾지 못하여 에러가 발생한 시행착오 경험)

5. 2번과 3번에 대해서 반복을 수행합니다.



#### 인스타그램 크롤링 시행착오

1. 포스팅한 게시물 중에서 본문 내용 전체가 비어있는 경우가 있었고 이러한 에러에 대해서 본문 내용과 게시날짜는 NA 값으로 입력 받을 수 있도록 if함수를 이용하여 코드를 구성했습니다.

   ![예외1](https://user-images.githubusercontent.com/74410630/112266095-e80c7880-8cb6-11eb-8c9d-965441d8d7dc.JPG)


2. 댓글의 수의 관계없이 내용을 모두 크롤링을 해서 수집을 원했지만 포스팅에 따라 댓글의 수가 다르기 때문에 데이터셋의 원소의 수의 불일치로 데이터 프레임을 만드는 것이 제한이 되었으며, 우선적으로 첫번째 댓글의 내용만 수집하고 댓글이 없는 경우는 NA 값으로 처리하였습니다.
   ![제주도맛집](https://user-images.githubusercontent.com/74410630/112266010-cc08d700-8cb6-11eb-93b6-134b06227e2b.JPG)

3. 인스타그램의 스크롤은 무한으로 증가하고 있으며, 스크롤을 반복적으로 빠르게 증가할 경우 더 이상의 스크롤이 내려가지 않는 현상이 발생하였고 스크롤 이동시간을 최초 3초에서 5초의 텀으로 변경 후 실행했을 경우 더 많이 스크롤이 이동하였지만 어느 시점에 되었을 경우 더이상 스크롤이 증가하지 않았습니다.

   ![예외4](https://user-images.githubusercontent.com/74410630/112266225-0ffbdc00-8cb7-11eb-9512-48c2a688df10.JPG)

4. 처음에 작업수행을 위한 로직을 생각할 때 첫 번째 포스팅을 클릭하고 필요한 정보의 데이터를 저장하고 'X' 버튼을 클릭한 다음에 다시 두번째 포스팅을 클릭하여 동일한 작업을 반복적으로 수행하도록 생각했습니다. 그런데 작업 중간에 구글링을 통해서 이미 유사한 프로젝트를 수행했던 기록을 참고하게 되었고 포스팅을 클릭하면 이전 포스팅과 다음 포스팅으로 이동할 수 있는 화살표 모양의 좌측,우측 클릭 버튼으로 로직을 변경하면 더 빠르게 데이터를 수집할 수 있다는 것을 알게 되었습니다.

5. 우측 화살표 모양의 버튼을 클릭하면서 반복적으로 필요한 데이터 정보를 수집할 수 있도록 코드를 변경하여 작업을 수행하였는데 모든 내용이 보이지 않고 우측 또는 좌측 화살표 모양의 버튼을 클릭해도 로딩이 지연되고 결과가 지속되었습니다. (우측 상단의 X 버튼을 클릭하고 마지막 포스팅을 클릭해도 동일한 결과가 발생)

   ![예외2](https://user-images.githubusercontent.com/74410630/112266257-1a1dda80-8cb7-11eb-847f-d2afb9c4fd4e.JPG)

6. 계정을 변경하여 다시 작업을 수행하였고 1000개 정도의 데이터 수집이 수월하게 진행되다가 다시 새로운 오류가 발생하였습니다. 우측 버튼의 화살표 모양이 보이지 않는 결과가 발생하였습니다. 포스팅한 컨텐츠가 마지막이라고 하기에는 `#제주도맛집` 3백만개의 해시테그 결과중에서 만개도 받지 못한 상태에서 더 이상 데이터를 로딩하지 못해서 다음 작업을 수행할 수가 없었습니다.

   ![예외3](https://user-images.githubusercontent.com/74410630/112266302-24d86f80-8cb7-11eb-8ff6-5cfb1fe0c845.JPG)

7. 포스팅의 필요한 정보를 저장하고 다음 포스팅으로 넘어갈 때 시간적 여유를 더 길게 설정하도록 변경하였고(2초 -> 3초, 3초 -> 4초, 4초 -> 5초 총 3번 변경) 12,000개 이상의 데이터를 수집할 수 있었지만 결국 동일하게 우측 버튼을 못찾아서 에러가 발생하였고 수집된 데이터를 전처리하고 분석을 2일 이내에 완료해야 했기 때문에 데이터 수집은 종료하였습니다.

   ![10,000개 이상 데이터수집 화면](https://user-images.githubusercontent.com/74410630/112266341-2dc94100-8cb7-11eb-89ad-28a022f5112d.JPG)
   

#### 데이터 수집 후기

- **무한스크롤:** 

  무한스크롤 이벤트를 반복적으로 수행할 경우 1,000번의 반복을 수행하기 전에 스크롤을 더이상 내려갈 수 없도록 웹(크롬)에서 중단됩니다. 인스타그램은 스크롤은 최하단을 내릴 경우 컨텐츠가 처음에는 3행x8열 = 24개씩 증가하다가 어느 시점부터는 불규칙하게 증가합니다. 그런데 반복적으로 스크롤을 내릴 경우 인스타그램 서버에서 더 이상 컨텐츠를 제공하지 않는 이슈가 있었기 때문에 반복적으로 스크롤을 내려가는 코드를 3초 ~ 5초 랜덤으로 반응하도록 구성하였지만 그래도 결과를 동일하게 웹(크롬)에서 중단되었습니다. 결국 중단된 위치의 컨텐츠를 무식한 방법으로 스크롤을 내리면서 다시 찾고 반복을 수행하는 것을 다시 수행하여 약 12,000개의 데이터만 수집하였고 그 이상의 데이터를 수집을 하기 위한 방법이 있을지 몹시 궁금한 상태로 웹크롤링 데이터 수집의 작업을 끝마치게 되었습니다.

- **날짜 수집:** 

  날짜의 데이터를 수집할 때 일관성이 없이 불규칙한 컨텐츠의 날짜가 중간에 출력되었습니다. 예를들어 2021년 3월 19일과 3월 20일 사이에 1월 컨텐츠가 포함되어 있는 경우가 있었으며, 이유는 알수 없지만 이런 이슈로 인하여 2021년 3월 포스팅한 모든 정보를 반복문 코드를 입력할 때 언제까지 반복문을 수행해야할지 고민이 되었으며 결국 1일동안 컨텐츠양을 대략적으로 계산해서 일수를 곱한만큼 반복문을 수행하도록 코드를 구성했습니다. (1일동안 컨텐츠양 = 약 1,000개, --> 20일 = 20,000개 --> 20,000번 반복수행)

- **댓글과 대댓글 수집:** 

  각각의 컨텐츠마다 댓글과 대댓글의 수가 불규칙하기 때문에 데이터를 수집했을 때 원소의 수가 각각 다를 것 입니다. 원소의 수가 다른 벡터들로 구성된 데이터셋을 데이터프레임으로 만드는 것은 제한이 되기 때문에 데이터프레임을 만들기 위해서 댓글과 대댓글의 첫번째 데이터가 있을 경우와 없을 경우만 비교를 해서 데이터를 수집하였습니다. 시간적 여유가 있다면 댓글과 대댓글의 수가 몇개인지 관계없이 모두 수집하여 데이터프레임을 만들 수 있는 코드를 작성할 예정입니다.

